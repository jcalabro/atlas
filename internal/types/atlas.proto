syntax = "proto3";

package types;
option go_package = "github.com/jcalabro/atlas/internal/types";

import "google/protobuf/timestamp.proto";

//
// Types stored in FoundationDB
//

message Actor {
  string did = 1;
  google.protobuf.Timestamp created_at = 2;
  string email = 3;
  string email_verification_code = 4;
  bool email_confirmed = 5;
  bytes password_hash = 6;
  bytes signing_key = 7;
  string handle = 8;
  bool active = 9;
  repeated bytes rotation_keys = 10;
  repeated RefreshToken refresh_tokens = 11;
  string head = 12;
  string rev = 13;
  string pds_host = 14; // hostname of the PDS this actor belongs to
}

message RefreshToken {
  string token = 1;
  google.protobuf.Timestamp created_at = 2;
  google.protobuf.Timestamp expires_at = 3;
}

// Record represents a single record in a user's repo
message Record {
  string did = 1;
  string collection = 2;  // NSID, e.g. "app.bsky.feed.post"
  string rkey = 3;        // record key (TID or user-specified)
  string cid = 4;         // CID of the record content
  bytes value = 5;        // CBOR-encoded record data
  google.protobuf.Timestamp created_at = 6;
}
